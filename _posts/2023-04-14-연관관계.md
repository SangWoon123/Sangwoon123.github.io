---
published: true
layout: single
title:  "연관관계"
toc: true
toc_sticky: true
toc_label: "  "
---

# 단방향 연관관계

객체를 테이블에 맞추어 데이터 중심으로 모델링하면, 협력 관계를 만들 수 없다.

- 테이블은 외래 키로 조인을 사용해서 연관된 테이블을 찾는다.
- 객체는 참조를 사용해서 연관된 객체를 찾는다.
- 테이블과 객체 사이에는 이런 큰 간격이 존재

```java
EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");

        EntityManager em=emf.createEntityManager();

        EntityTransaction tx = em.getTransaction();
        tx.begin();

        try{
            Team team=new Team();
            team.setName("TeamA");
            em.persist(team);

            Member member=new Member();
            member.setUsername("member1");
            member.setTeamId(team.getId());
            em.persist(member);

            Member findMember = em.find(Member.class, member.getId());

            
            Long findTeamId = findMember.getTeamId();
            Team findTeam = em.find(Team.class, findTeamId);

            tx.commit();
        }catch (Exception e){
            tx.rollback();
        }finally {
            em.close();
        }
        emf.close();
    }
```

### 단방향 연관관계

```java
@Entity
public class Member {

   @Id @GeneratedValue
    private Long id;

   @Column(name = "USERNAME")
   private String username;

   @Column(name = "TEAM_ID")
   private Long teamId;

}
```

다음과 같이 객체적이지 않은 엔티티 매핑관계를

```java
@Entity
public class Member {

   @Id @GeneratedValue
    private Long id;

   @Column(name = "USERNAME")
   private String username;

   @ManyToOne
   @JoinColumn(name = "TEAM_ID")
   private Team team;
}
```

다음과 같이 team객체를 직접적으로 이용하여 객체지향적으로 만들 수 있다.

# 양방향 연관관계와 연관관계의 주인

![연관관계](/assets/images/연관관계.png) 

객체와 테이블의 차이

테이블 연관관계에선 foriegn key를 사용하여 Member 와 Team 테이블을 연결해서 서로의 컬럼을 확인 할 수 있지만 객체는 할 수 없다.

```java
@ManyToOne
@OneToMany(mappedBy = "team")
```

\@OneToMany와 \@ManyToOne은 단방향 연결설정 @JoinColumn으로 연결

mappedBy 설정은 나: One 연결된상대: Many 일때, Many에서 정의된 나

즉, Member와 Team을 예시로 들때 Member안에 정의된 “Team team” 과매핑된다는 뜻

# mappedBy

객체와 테이블이 관계를 맺는 차이

객체는 ‘단방향’으로 서로를 참조가능 이는 자칫하면 양방향으로 보일 수 있으나 명백히 ‘단방향’이 2번 이루어진 관계이다.

테이블은 ‘조인’으로 양방향 참조가능

### 문제

테이블은 조인으로 관리할수있지만, 테이블은 누가 관리하지?

### 연관관계의 주인

양방향 매핑 규칙

- 객체의 두 관계중 하나를 연관관계의 주인으로 지정
- 연관관계의 주인만이 외래 키를 관리(등록,수정)
- 주인이 아닌 쪽은 읽기만 가능
- 주인은 mappedBy 속성 사용 X
- 주인이 아니면 mappedBy로 주인 속성 지정’

※ **매핑할때 외래키가 있는 곳을 주인으로 정해라** (비즈니스적 중요성과 상관이없음)

# 양방향 매핑

- **단방향 매핑만으로도 이미 연관관계 매핑은 완료**
- 양방향 매핑은 반대 방향으로 조회(객체 그래프 탐색) 기능이 추가된 것 뿐
- JPQL에서 역방향으로 탐색할 일이 많음
- 단방향 매핑을 잘 하고 양방향은 필요할 때 추가해도 됨

출처: 인프런 -JPA 기본편 [김영한]